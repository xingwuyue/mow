{"version":3,"sources":["file:///G:/Cocos/KillGrass/gecao/assets/scripts/PlayerRotation.ts"],"names":["_decorator","Component","Vec3","PlayerCombat","PlayerMovement","ccclass","property","PlayerRotation","tooltip","_combat","_movement","start","node","getComponent","parent","update","deltaTime","nearestEnemy","getNearestEnemy","_rotateTowards","worldPosition","isMoving","_rotateTowardsMovement","moveDir","getMoveDirection","angle","Math","atan2","y","x","PI","targetPos","currentPos","getWorldPosition","direction"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,I,OAAAA,I;;AAC7BC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,c,iBAAAA,c;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;gCAGjBO,c,WADZF,OAAO,CAAC,gBAAD,C,UAEHC,QAAQ,CAAC;AAAEE,QAAAA,OAAO,EAAE;AAAX,OAAD,C,2BAFb,MACaD,cADb,SACoCN,SADpC,CAC8C;AAAA;AAAA;;AAAA;;AAAA,eAIlCQ,OAJkC,GAIV,IAJU;AAAA,eAKlCC,SALkC,GAKN,IALM;AAAA;;AAO1CC,QAAAA,KAAK,GAAG;AACJ,eAAKF,OAAL,GAAe,KAAKG,IAAL,CAAUC,YAAV;AAAA;AAAA,2CAAf;AACA,eAAKH,SAAL,GAAiB,KAAKE,IAAL,CAAUE,MAAV,CAAiBD,YAAjB;AAAA;AAAA,+CAAjB;AACH;;AAEDE,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACtB,cAAMC,YAAY,GAAG,KAAKR,OAAL,CAAaS,eAAb,EAArB;;AACA,cAAID,YAAJ,EAAkB;AACd,iBAAKE,cAAL,CAAoBF,YAAY,CAACG,aAAjC;AACH,WAFD,MAEO,IAAI,KAAKV,SAAL,CAAeW,QAAf,EAAJ,EAA+B;AAClC,iBAAKC,sBAAL;AACH;AACJ;;AAEOA,QAAAA,sBAAsB,GAAG;AAC7B,cAAMC,OAAO,GAAG,KAAKb,SAAL,CAAec,gBAAf,EAAhB;;AACA,cAAI,CAACD,OAAL,EAAc,OAFe,CAI7B;;AACA,cAAME,KAAK,GAAGC,IAAI,CAACC,KAAL,CACVJ,OAAO,CAACK,CADE,EAEVL,OAAO,CAACM,CAFE,IAGV,GAHU,GAGJH,IAAI,CAACI,EAHD,GAGM,EAHpB,CAL6B,CAU7B;;AACA,eAAKlB,IAAL,CAAUa,KAAV,GAAkBA,KAAlB;AACH;;AAEON,QAAAA,cAAc,CAACY,SAAD,EAAkB;AACpC,cAAMC,UAAU,GAAG,KAAKpB,IAAL,CAAUqB,gBAAV,EAAnB;AACA,cAAMC,SAAS,GAAG,IAAIhC,IAAJ,CACd6B,SAAS,CAACF,CAAV,GAAcG,UAAU,CAACH,CADX,EAEdE,SAAS,CAACH,CAAV,GAAcI,UAAU,CAACJ,CAFX,EAGd,CAHc,CAAlB,CAFoC,CAQpC;;AACA,cAAMH,KAAK,GAAGC,IAAI,CAACC,KAAL,CAAWO,SAAS,CAACN,CAArB,EAAwBM,SAAS,CAACL,CAAlC,IAAuC,GAAvC,GAA6CH,IAAI,CAACI,EAAlD,GAAuD,EAArE,CAToC,CAWpC;;AACA,eAAKlB,IAAL,CAAUa,KAAV,GAAkBA,KAAlB;AACH;;AAhDyC,O;;;;;iBAEX,I","sourcesContent":["import { _decorator, Component, Node, Vec3 } from 'cc';\r\nimport { PlayerCombat } from './PlayerCombat';\r\nimport { PlayerMovement } from './PlayerMovement';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PlayerRotation')\r\nexport class PlayerRotation extends Component {\r\n    @property({ tooltip: '转向速度' })\r\n    public rotationSpeed: number = 1000;\r\n\r\n    private _combat: PlayerCombat = null;\r\n    private _movement: PlayerMovement = null;\r\n\r\n    start() {\r\n        this._combat = this.node.getComponent(PlayerCombat);\r\n        this._movement = this.node.parent.getComponent(PlayerMovement);\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        const nearestEnemy = this._combat.getNearestEnemy();\r\n        if (nearestEnemy) {\r\n            this._rotateTowards(nearestEnemy.worldPosition);\r\n        } else if (this._movement.isMoving()) {\r\n            this._rotateTowardsMovement();\r\n        }\r\n    }\r\n\r\n    private _rotateTowardsMovement() {\r\n        const moveDir = this._movement.getMoveDirection();\r\n        if (!moveDir) return;\r\n        \r\n        // 计算移动方向的角度\r\n        const angle = Math.atan2(\r\n            moveDir.y,\r\n            moveDir.x\r\n        ) * 180 / Math.PI - 90;\r\n\r\n        // 设置节点旋转\r\n        this.node.angle = angle;\r\n    }\r\n\r\n    private _rotateTowards(targetPos: Vec3) {\r\n        const currentPos = this.node.getWorldPosition();\r\n        const direction = new Vec3(\r\n            targetPos.x - currentPos.x,\r\n            targetPos.y - currentPos.y,\r\n            0\r\n        );\r\n\r\n        // 计算目标角度\r\n        const angle = Math.atan2(direction.y, direction.x) * 180 / Math.PI - 90;\r\n        \r\n        // 设置节点旋转\r\n        this.node.angle = angle;\r\n    }\r\n}"]}