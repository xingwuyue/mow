{"version":3,"sources":["file:///G:/Cocos/KillGrass/PlayableMowGame/PlayableMowGame/assets/scripts/Bullet.ts"],"names":["_decorator","Component","Vec3","CCFloat","UITransform","Rect","instantiate","Prefab","Enemy","HitEffect","ccclass","property","Bullet","type","tooltip","_direction","_spawnTime","_transform","init","direction","Date","now","onLoad","getComponent","addComponent","setContentSize","update","deltaTime","lifeTime","node","destroy","moveAmount","speed","currentPos","position","newPos","x","y","setPosition","checkCollision","bulletPos","worldPosition","bulletBBox","enemies","parent","getComponentsInChildren","enemy","isDead","enemyNode","enemyPos","enemyBBox","intersects","hitEffectPrefab","effect","effectPos","setWorldPosition","takeDamage","damage"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, CCFloat, BoxCollider2D, Collider2D, Contact2DType, IPhysics2DContact, UITransform, Rect, instantiate, Prefab } from 'cc';\nimport { Enemy } from './Enemy';\nimport { HitEffect } from './HitEffect';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Bullet')\nexport class Bullet extends Component {\n    @property({ type: CCFloat, tooltip: '子弹伤害' })\n    public damage: number = 50;\n\n    @property({ type: CCFloat, tooltip: '子弹飞行速度' })\n    public speed: number = 500;  // 增加速度使子弹更快\n\n    @property({ type: CCFloat, tooltip: '子弹销毁时间(秒)' })\n    public lifeTime: number = 1;\n\n    private _direction: Vec3 = new Vec3();\n    private _spawnTime: number = 0;\n\n    // 简化为只接收方向向量\n    public init(direction: Vec3) {\n        this._direction = direction;\n        this._spawnTime = Date.now();\n    }\n\n    private _transform: UITransform | null = null;\n\n    onLoad() {\n        // 获取 UITransform 组件\n        this._transform = this.getComponent(UITransform);\n        if (!this._transform) {\n            this._transform = this.addComponent(UITransform);\n        }\n        \n        // 设置子弹的尺寸\n        this._transform.setContentSize(20, 20);\n    }\n\n    update(deltaTime: number) {\n        if (Date.now() - this._spawnTime > this.lifeTime * 1000) {\n            this.node.destroy();\n            return;\n        }\n\n        // 增加移动速度\n        const moveAmount = this.speed * deltaTime * 2;  // 将速度翻倍\n        const currentPos = this.node.position;\n        const newPos = new Vec3(\n            currentPos.x + this._direction.x * moveAmount,\n            currentPos.y + this._direction.y * moveAmount,\n            0\n        );\n        \n        this.node.setPosition(newPos);\n        this.checkCollision();\n    }\n\n    @property({ type: Prefab, tooltip: '击中特效预制体' })\n    public hitEffectPrefab: Prefab | null = null;\n\n    private checkCollision() {\n        if (!this._transform) return;\n    \n        const bulletPos = this.node.worldPosition;\n        const bulletBBox = new Rect(\n            bulletPos.x - 15,\n            bulletPos.y - 15,\n            30,\n            30\n        );\n    \n        const enemies = this.node.parent?.getComponentsInChildren(Enemy) || [];\n        \n        for (const enemy of enemies) {\n            if (enemy.isDead()) continue;\n    \n            const enemyNode = enemy.node;\n            const enemyPos = enemyNode.worldPosition;\n            const enemyBBox = new Rect(\n                enemyPos.x - 25,\n                enemyPos.y - 25,\n                50,\n                50\n            );\n    \n            if (bulletBBox.intersects(enemyBBox)) {\n                // 创建击中特效\n                if (this.hitEffectPrefab) {\n                    const effect = instantiate(this.hitEffectPrefab);\n                    effect.parent = this.node.parent;\n                    const effectPos = new Vec3(bulletPos.x, bulletPos.y, 0);\n                    effect.setWorldPosition(effectPos);\n                    \n                    // 添加特效控制组件\n                    effect.addComponent(HitEffect);\n                }\n    \n                enemy.takeDamage(this.damage);\n                this.node.destroy();\n                break;\n            }\n        }\n    }\n}"]}